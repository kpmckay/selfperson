---
import { marked } from 'marked';

interface Props {
  date: Date;
  title: string;
  summary: string;
  link?: string;
  linkText?: string;
  tag?: string;
}

const { date, title, summary, link, linkText = 'Read more', tag } = Astro.props;

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date);
};

// Configure marked to handle inline markdown
marked.setOptions({
  breaks: true,  // Convert line breaks to <br>
  gfm: true,     // GitHub Flavored Markdown
});

// Render markdown in summary
const renderedSummary = marked.parseInline(summary);
---

<article class="border-b border-primary-200 pb-6 mb-6 last:border-b-0">
  <div class="flex items-start justify-between mb-2">
    <time class="text-sm text-primary-500" datetime={date.toISOString()}>
      {formatDate(date)}
    </time>
    {tag && (
      <span class="text-xs px-2 py-1 rounded bg-primary-600 text-white">
        {tag}
      </span>
    )}
  </div>

  <h3 class="text-xl font-semibold mb-2">
    {link ? (
      <a
        href={link}
        target="_blank"
        rel="noopener noreferrer"
        class="hover:text-primary-700 transition-colors"
      >
        {title}
      </a>
    ) : (
      <span>{title}</span>
    )}
  </h3>

  <p class="text-primary-700 leading-relaxed markdown-content" set:html={renderedSummary}></p>

  {link && (
    <a
      href={link}
      target="_blank"
      rel="noopener noreferrer"
      class="inline-flex items-center mt-3 text-sm text-primary-600 hover:text-primary-800 font-medium"
    >
      {linkText}
      <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </a>
  )}
</article>

<style>
  .markdown-content :global(a) {
    color: rgb(37 99 235); /* text-primary-600 equivalent */
    text-decoration: underline;
    transition: color 0.2s;
  }

  .markdown-content :global(a:hover) {
    color: rgb(29 78 216); /* text-primary-800 equivalent */
  }

  .markdown-content :global(strong) {
    font-weight: 600;
  }

  .markdown-content :global(em) {
    font-style: italic;
  }

  .markdown-content :global(br) {
    display: block;
    content: "";
    margin-top: 0.5em;
  }
</style>
